import MeCab
from mlask import MLAsk
import re


model = MLAsk()

def clean_text(text):
    text = text.encode('utf-8', errors='ignore').decode('utf-8')
    text = re.sub(r'\n', ' ', text)
    text = re.sub(r'\s+', ' ', text)
    text = text.replace('　', ' ')
    return text.strip()

def analyze_ml_ask(text):
    text_str = clean_text(text)  # 変更

    try:
        analysis = model.analyze(text_str)
        print("バックエンドでの分析結果:", analysis)
        if analysis and 'emotion' in analysis:
            if analysis['emotion']:
                print("感情が検出されました。")
            else:
                print("感情なしと判定されました。")
        else:
            print("予期しない分析結果形式です。")
    except Exception as e:
        print("MLAsk分析中にエラーが発生しました:", str(e))
        analysis = {"error": str(e)}
    return analysis